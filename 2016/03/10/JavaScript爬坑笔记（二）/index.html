<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> JavaScript爬坑笔记（二） | Littlewin's blog</title><meta name="description" content="JavaScript爬坑笔记（二） - Littlewin"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/casual.css"><link rel="stylesheet" href="/css/icon.css"><link rel="search" type="application/opensearchdescription+xml" href="http://littlewin.info/atom.xml" title="Littlewin's blog"></head><body><div class="header"><header class="site-header"><div class="site-nav"><span class="button-toggle"></span><div class="container"><div class="nav-item"><a href="/" target="_self">主页</a></div><div class="nav-item"><a href="/archives" target="_self">归档</a></div><div class="nav-item"><a href="/about" target="_self">关于</a></div><div class="nav-item"><a href="/atom.xml" target="_self">订阅</a></div></div><form id="search-form" class="nav-item"><input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" autocomplete="off" autocorrect="off" class="search form-control"><span onclick="resetSearch()" class="fa fa-times"> </span></form><div id="local-search-result"></div><p class="no-result">No results found</p></div></header></div><div class="main"><div class="container"><div class="content"><div class="post"><article class="post-block"><h1 class="post-title">JavaScript爬坑笔记（二）</h1><span class="post-date">2016年3月10日</span><span class="post-tag"><a href="/tags/前端/">前端</a><a href="/tags/JavaScript/">JavaScript</a></span><img src="http://7xpot0.com1.z0.glb.clouddn.com/public/16-12-5/39797105.jpg" class="bgimage"><div class="post-content"><p>接着前面的路继续“爬坑”，希望能将JS中更多典型的问题分享出来。<br><a id="more"></a></p>
<h3 id="一、数据类型判断"><a href="#一、数据类型判断" class="headerlink" title="一、数据类型判断"></a>一、数据类型判断</h3><p>JavaScript中有5种基本数据类型和一种复杂数据类型。</p>
<ul>
<li><strong>Null</strong>, <strong>Undefined</strong><br>特殊值</li>
<li><strong>number</strong><br>所有的数值类型，也包括伪数值<strong>NaN</strong>和<strong>Infinity</strong></li>
<li><strong>boolean</strong><br><code>true</code>和<code>false</code></li>
<li><strong>string</strong><br>字符类型</li>
</ul>
<p>其余类型在JavaScript中都为Object类型，比如<strong>function</strong>和<strong>array</strong>。</p>
<h4 id="1-typeof方法"><a href="#1-typeof方法" class="headerlink" title="1. typeof方法"></a>1. <code>typeof</code>方法</h4><p><code>typeof</code>方法是JavaScript中返回类型的原生方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span> <span class="comment">// "undefined" </span></div><div class="line"><span class="keyword">typeof</span> <span class="number">0</span>    <span class="comment">// "number" </span></div><div class="line"><span class="keyword">typeof</span> <span class="literal">true</span> <span class="comment">// "boolean" </span></div><div class="line"><span class="keyword">typeof</span> <span class="string">"foo"</span> <span class="comment">// "string" </span></div><div class="line"><span class="keyword">typeof</span> &#123;&#125; <span class="comment">// "object" </span></div><div class="line"><span class="comment">// 注意下面三行</span></div><div class="line"><span class="keyword">typeof</span> <span class="literal">null</span>  <span class="comment">// "object" </span></div><div class="line"><span class="keyword">typeof</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; <span class="comment">// "function" </span></div><div class="line"><span class="keyword">typeof</span> <span class="literal">NaN</span>  <span class="comment">// "number"</span></div></pre></td></tr></table></figure>
<ul>
<li><code>typeof null == &quot;object&quot;</code>算是JS语言中的一个内置Bug。</li>
<li>按照语言数据类型定义，Functions应该属于Object类型。</li>
<li><code>typeof NaN == &#39;number&#39;</code>略显滑稽，NaN本来是Not A Number的缩写。</li>
</ul>
<p>此外<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typeof</span> &#123;&#125;  <span class="comment">// 'object'</span></div><div class="line"><span class="keyword">typeof</span> []  <span class="comment">// 'object'</span></div><div class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">Date</span>  <span class="comment">// 'object'</span></div></pre></td></tr></table></figure></p>
<p><code>typeof</code>无法识别具体的Object类型。</p>
<p>简而言之，<code>typeof</code>函数适用于基本类型的判断。同时，由于<strong>Uncaught ReferenceError</strong>的存在，不要用<code>typeof</code>函数检测变量的存在性。最佳实践是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x</span>) </span>&#123;</div><div class="line"> <span class="keyword">if</span> (<span class="keyword">typeof</span> x == <span class="string">'function'</span>) &#123;</div><div class="line">    ... <span class="comment">// in case when x is a function</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    ... <span class="comment">// in other cases</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-toString方法"><a href="#2-toString方法" class="headerlink" title="2. toString方法"></a>2. <code>toString</code>方法</h4><p><code>toString</code>方法是最为可靠的类型检测手段，它会将当前对象转换为字符串并输出。<code>toString</code>属性定义在<code>Object.prototype</code>上，因而所有对象都拥有<code>toString</code>方法。 但<strong>Array</strong>, <strong>Date</strong>等对象会重写从<code>Object.prototype</code>继承来的<code>toString</code>， 所以最好用<code>Object.prototype.toString</code>来检测类型。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">toString = <span class="built_in">Object</span>.prototype.toString;</div><div class="line">toString.call(<span class="keyword">new</span> <span class="built_in">Date</span>); <span class="comment">// [object Date]</span></div><div class="line">toString.call(<span class="keyword">new</span> <span class="built_in">String</span>); <span class="comment">// [object String]</span></div><div class="line">toString.call(<span class="built_in">Math</span>); <span class="comment">// [object Math]</span></div><div class="line">toString.call(<span class="number">3</span>); <span class="comment">// [object Number]</span></div><div class="line">toString.call([]); <span class="comment">// [object Array]</span></div><div class="line">toString.call(&#123;&#125;); <span class="comment">// [object Object]</span></div><div class="line"></div><div class="line"><span class="comment">// Since JavaScript 1.8.5</span></div><div class="line">toString.call(<span class="literal">undefined</span>); <span class="comment">// [object Undefined]</span></div><div class="line">toString.call(<span class="literal">null</span>); <span class="comment">// [object Null]</span></div></pre></td></tr></table></figure>
<p>对于原生对象和内置数据类型，<code>toString</code>方法是非常适用的。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">function Animal(name) &#123; </div><div class="line">  this.name = name</div><div class="line">&#125;</div><div class="line">var animal = new Animal("Goofy")</div><div class="line">var class = &#123;&#125;.toString.apply(animal)</div><div class="line">alert(class) // [object Object]</div></pre></td></tr></table></figure>
<h4 id="3-检测自定义类型"><a href="#3-检测自定义类型" class="headerlink" title="3. 检测自定义类型"></a>3. 检测<strong>自定义类型</strong></h4><p>检测自定义类型通常使用<code>instanceof</code>方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params">name</span>) </span>&#123; </div><div class="line">  <span class="keyword">this</span>.name = name</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> animal = <span class="keyword">new</span> Animal(<span class="string">"Goofy"</span>)</div><div class="line"></div><div class="line">alert( animal <span class="keyword">instanceof</span> Animal ) <span class="comment">// true</span></div></pre></td></tr></table></figure>
<h4 id="4-Duck-Typing"><a href="#4-Duck-Typing" class="headerlink" title="4. Duck Typing"></a>4. Duck Typing</h4><p>目前前端惯例是使用Duck Typing的方式，比如jQuery是这样判断一个Window的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">isWindow: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123; </div><div class="line">  <span class="keyword">return</span> obj &amp;&amp; <span class="keyword">typeof</span> obj === <span class="string">'object'</span> &amp;&amp; <span class="string">"setInterval"</span> <span class="keyword">in</span> obj;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="二、使用匿名函数"><a href="#二、使用匿名函数" class="headerlink" title="二、使用匿名函数"></a>二、使用匿名函数</h3><p>匿名函数就是指没有分配名称，直接通过函数表达式定义的函数。关于函数表达式和函数声明的区别在<a href="http://littlewin.info/2016/02/28/JavaScript%E7%88%AC%E5%9D%91%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/" title="JavaScript爬坑笔记（一）">上节</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// function expression</span></div><div class="line"><span class="keyword">var</span> sayHello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</div><div class="line">  alert(<span class="string">"hi"</span>);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// in an object</span></div><div class="line"><span class="keyword">var</span> Person = &#123;</div><div class="line">  sayHello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    alert(<span class="string">"hi"</span>);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// event handler</span></div><div class="line">$(<span class="string">"p"</span>).click = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  alert(<span class="string">"hello"</span>);</div><div class="line">&#125;; </div><div class="line"></div><div class="line"><span class="comment">// ajax callback from http://api.jquery.com/jQuery.ajax/</span></div><div class="line">$.ajax(&#123;</div><div class="line">  url: <span class="string">"test.html"</span>,</div><div class="line">  context: <span class="built_in">document</span>.body,</div><div class="line">  success: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    $(<span class="keyword">this</span>).addClass(<span class="string">"done"</span>);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Self-evoking anonymous functions</span></div><div class="line">((<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  alert(<span class="string">"hi"</span>);</div><div class="line">&#125;)());</div></pre></td></tr></table></figure>
<h4 id="使用匿名函数"><a href="#使用匿名函数" class="headerlink" title="使用匿名函数"></a>使用匿名函数</h4><p>匿名函数有如下好处：</p>
<ul>
<li>代码简洁性，通常匿名函数会在回调函数和事件处理函数中被调用。</li>
<li>控制作用域，匿名函数可以创建私有的作用域，不会干扰其他作用域。</li>
<li>匿名函数可以便于实现闭包和递归函数。</li>
</ul>
<h5 id="以jQuery为例"><a href="#以jQuery为例" class="headerlink" title="以jQuery为例"></a>以jQuery为例</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> (<span class="function"><span class="keyword">function</span>(<span class="params"> window, undefined </span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> jQuery = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="comment">// Expose jQuery to the global object</span></div><div class="line">  <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</div><div class="line"></div><div class="line">  <span class="comment">//</span></div><div class="line">&#125;)(<span class="built_in">window</span>);</div></pre></td></tr></table></figure>
<p>上面是个立即执行的匿名函数，其中定义的变量作用范围都是匿名函数以内，不会影响全局域。而且在函数执行完后，其作用域链也会及时清理。</p>
<h5 id="在递归函数中也常常使用匿名函数"><a href="#在递归函数中也常常使用匿名函数" class="headerlink" title="在递归函数中也常常使用匿名函数"></a>在递归函数中也常常使用匿名函数</h5><p>通常会配合<code>arguments.callee</code>方法一起使用，避免函数名称变更引起的递归错误。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">  </div><div class="line">  <span class="keyword">if</span> (n &lt; <span class="number">2</span>)</div><div class="line">    <span class="keyword">return</span> n;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (f.answers[n] != <span class="literal">null</span>)</div><div class="line">    <span class="keyword">return</span> f.answers[n];</div><div class="line"></div><div class="line">  f.answers[n] = <span class="built_in">arguments</span>.callee(n - <span class="number">1</span>) + <span class="built_in">arguments</span>.callee(n - <span class="number">2</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> f.answers[n];</div><div class="line">&#125;</div><div class="line"></div><div class="line">f.answers =&#123;&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> fibo = f;</div><div class="line">alert(fibo(<span class="number">10</span>)); <span class="comment">//55</span></div><div class="line">alert(fibo(<span class="number">11</span>)); <span class="comment">//89</span></div></pre></td></tr></table></figure>
<p>这种机制确保即使将函数赋值给另外的变量，也能正常实现函数递归；同时，将每次递归的计算值保存，避免了多次重复的计算过程。</p>
<h5 id="在闭包中的使用"><a href="#在闭包中的使用" class="headerlink" title="在闭包中的使用"></a>在闭包中的使用</h5><p>各种专业文献上的”闭包”（closure）定义非常抽象，很难看懂。我的理解是，闭包就是能够读取其他函数内部变量的函数。</p>
<p>由于在Javascript语言中，只有函数内部的子函数才能读取局部变量，因此可以把闭包简单理解成”定义在一个函数内部的函数”。</p>
<p>所以，在本质上，闭包就是将函数内部和函数外部连接起来的一座桥梁。而匿名函数和闭包基本上是相辅相成的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'#foo'</span>).click( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  alert(<span class="string">'User clicked on "foo."'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>在闭包中使用循环常常出现错误，比如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</div><div class="line">  $(<span class="string">'#Div'</span> + i).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    alert(<span class="string">'#Div'</span> + i + <span class="string">" is kicked"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述代码会输出10次‘#Div10  is kicked’，而利用匿名函数做下修改，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</div><div class="line">  (<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</div><div class="line">    $(<span class="string">'#Div'</span> + v).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      alert(<span class="string">'Div'</span> + v + <span class="string">" is kicked"</span>);</div><div class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;)</div><div class="line">  &#125;)(i);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此时，代码的输出会如我们预期。</p>
<p>更多闭包的细节将在下一章中展开。</p>
<h5 id="A-quiz"><a href="#A-quiz" class="headerlink" title="A quiz"></a>A quiz</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> foo = &#123;</div><div class="line">  bar: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.baz; &#125;,</div><div class="line">  baz: <span class="number">1</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> <span class="built_in">arguments</span>[<span class="number">0</span>]();</div><div class="line">&#125;)(foo.bar);</div></pre></td></tr></table></figure>
<blockquote>
<p>返回值是“undefined”</p>
</blockquote>
<p>关注<strong>this</strong>的指向是理解这个过程的重点，开始调用<code>foo.bar()</code>时，<strong>this</strong>指向<strong>foo</strong>，而在匿名函数中调用<code>arguments[0]()</code>,<strong>this</strong>指向<strong>arguments</strong>，显然<code>arguments.baz</code>是<strong>undefined</strong>。</p>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>要理解闭包，首先必须理解Javascript特殊的变量作用域。</p>
<p>变量的作用域无非就是两种：全局变量和局部变量。</p>
<h4 id="闭包的定义"><a href="#闭包的定义" class="headerlink" title="闭包的定义"></a>闭包的定义</h4><blockquote>
<p>闭包就是能够读取其他函数内部变量的函数。</p>
</blockquote>
<p>闭包这个概念引入了三个作用域链，访问其自己的作用域，访问外部作用域和访问全局作用域。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showName</span> (<span class="params">firstName, lastName</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> nameIntro = <span class="string">"Your name is "</span>;</div><div class="line">  ​<span class="function"><span class="keyword">function</span> <span class="title">makeFullName</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> nameIntro + firstName + <span class="string">" "</span> + lastName;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> makeFullName ();</div><div class="line">&#125;</div><div class="line"></div><div class="line">showName(<span class="string">"Michael"</span>, <span class="string">"Jackson"</span>); <span class="comment">// Your name is Michael Jackson</span></div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> selections = []; </div><div class="line">  $(<span class="string">".inners"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// this closure has access to the selections variable​</span></div><div class="line">    selections.push (<span class="keyword">this</span>.prop(<span class="string">"name"</span>)); </div><div class="line">    <span class="comment">// update the selections variable in the outer function's scope​</span></div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="闭包的使用原则和注意事项"><a href="#闭包的使用原则和注意事项" class="headerlink" title="闭包的使用原则和注意事项"></a>闭包的使用原则和注意事项</h4><blockquote>
<p>闭包可以在外部函数返回后访问其变量</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">celebrityName</span> (<span class="params">firstName</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> nameIntro = <span class="string">"This celebrity is "</span>;</div><div class="line">  <span class="comment">// this inner function has access to the outer function's variables, including the parameter​</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">lastName</span> (<span class="params">theLastName</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> nameIntro + firstName + <span class="string">" "</span> + theLastName;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> lastName;</div><div class="line">&#125;</div><div class="line">​</div><div class="line">​<span class="keyword">var</span> mjName = celebrityName(<span class="string">"Michael"</span>); <span class="comment">// At this juncture, the celebrityName outer function has returned.​</span></div><div class="line">​</div><div class="line">​<span class="comment">// The closure (lastName) is called here after the outer function has returned above​</span></div><div class="line">​<span class="comment">// Yet, the closure still has access to the outer function's variables and parameter​</span></div><div class="line">mjName (<span class="string">"Jackson"</span>); <span class="comment">// This celebrity is Michael Jackson</span></div></pre></td></tr></table></figure>
<p><strong>celebrityName</strong>返回后，实际上相当于在全局域上创建了一个函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mjName = <span class="function"><span class="keyword">function</span> <span class="title">lastName</span>(<span class="params">theLastName</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> firstName = <span class="string">"Michael"</span>;</div><div class="line">  <span class="keyword">return</span> nameIntro + firstName + <span class="string">" "</span> + theLastName;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>闭包储存了外部函数变量的引用</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">celebrityID</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> celebrityID = <span class="number">999</span>;</div><div class="line">  <span class="comment">// We are returning an object with some inner functions​</span></div><div class="line">  <span class="comment">// All the inner functions have access to the outer function's variables​</span></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    getID: <span class="function"><span class="keyword">function</span> (<span class="params"></span>)  </span>&#123;</div><div class="line">      <span class="comment">// This inner function will return the UPDATED celebrityID variable​</span></div><div class="line">      <span class="comment">// It will return the current value of celebrityID, even after the changeTheID function changes it​</span></div><div class="line">      <span class="keyword">return</span> celebrityID;</div><div class="line">    &#125;,</div><div class="line">    setID: <span class="function"><span class="keyword">function</span> (<span class="params">theNewID</span>)  </span>&#123;</div><div class="line">      <span class="comment">// This inner function will change the outer function's variable anytime​</span></div><div class="line">      celebrityID = theNewID;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> mjID = celebrityID(); <span class="comment">// At this juncture, the celebrityID outer function has returned</span></div><div class="line">mjID.getID(); <span class="comment">// 999</span></div><div class="line">mjID.setID(<span class="number">567</span>); <span class="comment">// Changes the outer function's variable</span></div><div class="line">mjID.getID(); <span class="comment">// 567: It returns the updated celebrityId variable</span></div></pre></td></tr></table></figure>
<blockquote>
<p>闭包失效</p>
</blockquote>
<p>参考<a href="#在闭包中的使用" title="在闭包中的使用">在闭包中的使用</a>，返回闭包时牢记的一点就是：返回函数不要引用任何循环变量，或者后续会发生变化的变量。如果一定要引用循环变量怎么办？方法是再创建一个函数，用该函数的参数绑定循环变量当前的值，无论该循环变量后续如何更改，已绑定到函数参数的值不变。</p>
<p>本文完，以上。</p>
</div></article></div><div class="post-paginator"><div class="post-links"><div class="post-prev"><a href="/2016/03/22/JavaScript爬坑笔记（三）/" class="prev">上一篇<span>JavaScript爬坑笔记（三）</span></a></div><div class="post-next"><a href="/2016/02/28/JavaScript爬坑笔记（一）/" class="next">下一篇<span>JavaScript爬坑笔记（一）</span></a></div></div></div><div data-thread-key="2016/03/10/JavaScript爬坑笔记（二）/" data-title="JavaScript爬坑笔记（二）" data-url="http://littlewin.info/2016/03/10/JavaScript爬坑笔记（二）/" class="ds-share"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><span class="ds-more">分享到：</span></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul></div></div><div data-thread-key="2016/03/10/JavaScript爬坑笔记（二）/" data-title="JavaScript爬坑笔记（二）" data-url="http://littlewin.info/2016/03/10/JavaScript爬坑笔记（二）/" data-author-key="1" class="ds-thread"></div></div><div class="sidebar"><div class="social-links"><ul><li class="social-link"><a href="http://github.com/littlewin-wang" target="_blank" class="link-github"><i class="icon icon-github"></i></a></li><li class="social-link"><a href="http://twitter.com/littlewin_wang" target="_blank" class="link-twitter"><i class="icon icon-twitter"></i></a></li><li class="social-link"><a href="http://weibo.com/fredinweibo" target="_blank" class="link-weibo"><i class="icon icon-weibo"></i></a></li></ul></div><div class="recent-posts widget"><h3 class="widget-title"> 近期文章</h3><div class="widget-content"><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/01/15/假如雨天也要唱歌的话/">假如雨天也要唱歌的话</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/30/2016年终总结/">2016年终总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/22/To be 27/">To be 27</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/09/再谈Littlewin/">再谈Littlewin</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/20/11月的Littlewin/">11月的Littlewin</a></li></ul></div></div><div class="recent-comment widget"><h3 class="widget-title"> 近期评论</h3><div class="widget-content"></div><ul class="ds-recent-comments" data-num-items="5" data-show-avatars="1" data-show-time="1" data-show-admin="1" data-excerpt-length="70" id="ds-recent-comments"></ul></div><div class="tag-lists widget"><h3 class="widget-title"> 标签</h3><div class="widget-content"><a class="tag-link" href="/tags/HTML/">HTML</a> <a class="tag-link" href="/tags/JavaScript/">JavaScript</a> <a class="tag-link" href="/tags/Objective-C/">Objective-C</a> <a class="tag-link" href="/tags/iOS/">iOS</a> <a class="tag-link" href="/tags/前端/">前端</a> <a class="tag-link" href="/tags/工作/">工作</a> <a class="tag-link" href="/tags/感言/">感言</a> <a class="tag-link" href="/tags/生活/">生活</a></div></div><div class="archive-lists widget"><h3 class="widget-title"> 归档</h3><div class="widget-content"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">2</span></li></ul></div></div></div></div></div><footer><div class="copyright"><div class="container"><div class="col-6"><div class="site-info">© 2016 - 2017 <span class="icon icon"></span> <a href="http://littlewin.info">Littlewin</a><span class="sep">/</span><a href="https://hexo.io/" target="_blank">Powered by Hexo</a><span class="sep">/</span><a href="https://github.com/littlewin-wang/hexo-theme-casual" target="_blank">Theme by casual</a></div></div><div class="col-6"><div class="site-contact"><div class="social-links"><ul><li class="social-link"><a href="http://github.com/littlewin-wang" target="_blank" class="link-github"><i class="icon icon-github"></i></a></li><li class="social-link"><a href="http://twitter.com/littlewin_wang" target="_blank" class="link-twitter"><i class="icon icon-twitter"></i></a></li><li class="social-link"><a href="http://weibo.com/fredinweibo" target="_blank" class="link-weibo"><i class="icon icon-weibo"></i></a></li></ul></div></div></div></div></div></footer><a class="scroll-up"><span class="icon icon-up"></span></a><script>var duoshuoQuery = {short_name:"littlewin"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script><script src="/js/posfixed.js"></script><script src="/js/utils.js"></script><script src="/js/search.js"></script><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>